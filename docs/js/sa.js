"use strict";var _createClass=function(){function t(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var Debug=function(){function o(e,n){_classCallCheck(this,o),this.isDebug=Boolean(e),this.settings=n||{},!0===this.settings.showCoordinates&&this.showCoordinates()}return _createClass(o,[{key:"showCoordinates",value:function(){var n=this,o=L.popup();mymap.addEventListener("click",function(e){!0===n.settings.showCoordinates&&!0===n.status&&o.setLatLng(e.latlng).setContent("\n          <p>\n            <b>Coordinates</b><br>\n            <b>Lat:</b> "+SanAndreas.coordsTranslator("array",e.latlng)[0]+"<br>\n            <b>Lng:</b> "+SanAndreas.coordsTranslator("array",e.latlng)[1]+"<br>\n            <i>"+SanAndreas.coordsTranslator("array",e.latlng).toString()+"</i>\n          </p>\n          ").openOn(mymap)})}},{key:"log",value:function(e,n,o){if(!1===this.status||!1===this.settings.logging)return!1;switch(e){case"error":console.error(n,o);break;case"warn":console.warn(n,o);break;case"info":case"log":console.info(n,o);break;default:console.log(n,o)}}},{key:"status",get:function(){return this.isDebug},set:function(e){this.isDebug=Boolean(e)}},{key:"options",get:function(){return this.settings},set:function(e){void 0!==e.showCoordinates&&(this.settings.showCoordinates=Boolean(e.showCoordinates),this.showCoordinates()),void 0!==e.logging&&(this.settings.logging=Boolean(e.logging))}}]),o}(),SanAndreas={maps:{SASat:L.tileLayer("maps/SASat/{z}/{x}/{y}.png",{attribution:"San Andreas Satellite Map",minZoom:1,maxZoom:5,continuousWorld:!1,noWrap:!0}),SARoad:L.tileLayer("maps/SARoad/{z}/{x}/{y}.png",{attribution:"San Andreas Atlus Map",minZoom:1,maxZoom:5,continuousWorld:!1,noWrap:!0})},crs:L.extend({},L.CRS.Simple,{transformation:new L.Transformation(.04266666666,127.99999998,-.04266666666,127.99999998)}),coordsTranslator:function(e,n){return n instanceof Object&&!(n instanceof Array)?(debug.log("log","Coords converter got:","Object"),[n.lng.toFixed(4),n.lat.toFixed(4)]):n instanceof Array?(debug.log("log","Coords converter got:","Array"),[n[1].toFixed(4),n[0].toFixed(4)]):void debug.log("error","Coordinates are not correct","")}},mymap=L.map("mapid",{crs:SanAndreas.crs,maxBounds:[[3500,3500],[-3500,-3500]],layers:[SanAndreas.maps.SASat]});mymap.setView([0,0],2);var debug=new Debug(!0,{showCoordinates:!0,logging:!1}),Draw=function(){function n(e){_classCallCheck(this,n),this.editPanelShown=!1,this.control(e)}return _createClass(n,[{key:"editMap",value:function(o){this.editPanelShown||(this.editPanelShown=!0,this.drawnItems=new L.FeatureGroup,o.addLayer(this.drawnItems),o.addControl(new L.Control.Draw({draw:{polygon:{allowIntersection:!1,showArea:!0}}})),o.on(L.Draw.Event.CREATED,function(e){var n=e.layer.addTo(o);console.info(JSON.stringify(n.toGeoJSON()))}))}},{key:"control",value:function(e){var n=this;L.easyButton('<i class="fas fa-edit"></i>',function(){n.editMap(e)}).addTo(e)}}]),n}(),draw=new Draw(mymap),Areas=function(){function o(e,n){_classCallCheck(this,o),this.layer=new GetGeoJSON("json/SA_Police_Jursidictions.json",n,this.tooltipHandler,this.styleHandler),debug.log("info","Areas GeoJSON:",this.layer)}return _createClass(o,[{key:"styleHandler",value:function(e){switch(e){case"blue":return{color:"#00a8ff"};case"green":return{color:"#4cd137"};case"red":return{color:"#e84118"}}}},{key:"tooltipHandler",value:function(e,n){n.bindTooltip(e.properties.name)}}]),o}(),Places=function(){function o(e,n){_classCallCheck(this,o),this.layer=new GetGeoJSON("json/SA_Places.json",n,this.popupHandler),debug.log("info","Areas GeoJSON:",this.layer)}return _createClass(o,[{key:"popupHandler",value:function(e,n){n.bindPopup(e.properties.name),n.bindPopup("\n        <b>"+e.properties.name+"</b><br>\n        <p>"+e.properties.description+"</p>\n      ").setIcon(L.icon({iconUrl:"img/icons/"+e.properties.icon+".png",iconSize:[16,16]}))}}]),o}(),GetGeoJSON=function(){function r(e,n,o,t){_classCallCheck(this,r);var a=this.getJson(e);return this.drawLayer(a,n,o,t)}return _createClass(r,[{key:"getJson",value:function(e){var n=new XMLHttpRequest;if(n.open("GET",e,!1),n.send(),200===n.status)return JSON.parse(n.responseText);debug.log("error","GeoJSON request failed.\n",n.status+": "+n.statusText)}},{key:"drawLayer",value:function(e,n,o,t){var a=L.geoJSON(e,{style:void 0!==t?function(e){return t(e.properties.color)}:{},onEachFeature:void 0!==o?function(e,n){return o(e,n)}:void 0});return n&&a.addTo(mymap),a}}]),r}(),areas=new Areas("json/SA_Police_Jursidictions.json",!0),places=new Places("json/SA_Places.json",!0),layers={Satellite:SanAndreas.maps.SASat,Road:SanAndreas.maps.SARoad},overlays={"Police Jurisdictions":areas.layer,Locations:places.layer};L.control.layers(layers,overlays,{collapsed:!1}).addTo(mymap);